!function(t,i,e,o){"use strict";function r(t){return t.startOf("hour"),t}function s(t,i){return"local"==i?t.local():"utc"==i?t.utc():t.tz(i)}function n(t){var i=r(moment());return i.add(t,"hours"),i}function a(t,i){return s(n(t),i)}function m(t,i){var e=r(moment());return t===o?(r(i),t=i.diff(e,"hours")):(i=e,i.add(t,"hours")),{m:i,value:t}}var h=0;i.TimeSlider=function(e,o,r){function s(i,e,o){i[e]=i[e]||{};for(var r=0;r<o.length;r++){var s=o[r];"string"===t.type(i[e][s])&&(i[e][s]=t("#"+i[e][s]))}}o=t.extend({grid:!0,gridDistances:[1,2,3,6,12,24,48]},o),o.display=o.display||{},s(o.display,"from",["tzElement","utcElement","relativeElement"]),s(o.display,"to",["tzElement","utcElement","relativeElement"]),o.text=t.extend({hourAbbr:"h",minAbbr:"m",now:"now",to:"to"},o.text),o.text.nowUC=o.text.now.charAt(0).toUpperCase()+o.text.now.slice(1),o.values_separator=" "+o.text.to+" ",o.userOnChange=o.onChange||null,o.onChange=function(){this.onFunc(this.options.userOnChange),this.updateDisplay()};var n=m(o.min,o.minMoment);o.min=n.value,o.minMoment=n.m,n=m(o.max,o.maxMoment),o.max=n.value,o.maxMoment=n.m,i.BaseSlider.call(this,e,o,r),this.setFromValue(m(o.from,o.fromMoment).value),o.isInterval&&this.setToValue(m(o.to,o.toMoment).value),this.setFormat({},!0)},t.fn.timeSlider=function(e){return this.each(function(){t.data(this,"timeSlider")||t.data(this,"timeSlider",new i.TimeSlider(this,e,h++))})},i.TimeSlider.prototype={_valueToFormat:function(t,i){return i?a(t,i).format(this.options.display.formatStr):this.options.text.nowUC+(t>=0?" + ":" - ")+Math.abs(t)+this.options.text.hourAbbr},hhFormat:function(t){return t.format("24"==this.options.format.time?"HH":"hha")},hhmmFormat:function(t){return t.format("24"==this.options.format.time?"HH:mm":"hh:mma")},_prettify_relative:function(t){return this._valueToFormat(t)},_prettify_text_relative:function(t){return t},_prettify_absolute:function(t){return this._valueToFormat(t,this.options.format.timezone)},_prettify_text_absolute:function(t){var i=a(t,this.options.format.timezone);return this.hhFormat(i)},_prettify_text_absolute_date:function(t){return a(t,this.options.format.timezone).format(this.options.format.dateFormat)},adjustResult:function(){this.result.minMoment=n(this.result.min),this.result.maxMoment=n(this.result.max),this.result.fromMoment=n(this.result.from),this.result.toMoment=n(this.result.to)},appendDateGrid:function(t,i){var e,o,r,s,n,m=this.options,h=0,p=m.stepPx/m.step,f=0,u=!0,d=0,l=0,M=[];for(this.appendGridContainer(),this.calcGridMargin(),this.currentGridContainer.addClass("text-between-ticks"),this._prettify_text=this._prettify_text_absolute_date,e=m.min;e<=m.max;)(e-this.options.major_ticks_offset)%m.tickDistanceNum===0&&0===a(e,this.options.format.timezone).hour()&&(f++,this.appendTick(h,i),u&&(u=!1,d=e),l=e),e+=m.step,h+=m.stepP;if(o=p*(0===f?m.max-m.min:1==f?Math.max(d-m.min,m.max-d):24)-6,!m.format.dateFormat){switch(this.options.format.date){case"DMY":r=["ddd, DD. MMM YYYY","ddd, DD. MMM YY","DD. MMM YYYY","DD. MMM YY","DD/MM/YYYY","DD/MM/YY"];break;case"MDY":r=["ddd, MMM DD, YYYY","ddd, MMM DD, YY","MMM DD, YYYY","MMM DD, YY","MM/DD/YYYY","MM/DD/YY"];break;case"YMD":r=["ddd, YYYY MMM DD","ddd, YY MMM DD","YYYY MMM DD","YY MMM DD","YYYY/MM/DD","YY/MM/DD"]}for(e=m.min;e<=m.max;)M.push(e),e+=24;for(var c=0;c<r.length;c++){m.format.dateFormat=r[c],s=!0;for(var _=0;_<M.length;_++)if(this.getTextWidth(M[_],t)>o){s=!1;break}if(s)break}}if(0===f)this.appendText(m.stepP*((m.max-m.min)/2),m.min,t);else{if(n=this.getTextWidth(m.min,t),p*(d-m.min)>=n){var Y=m.min+n/2/p;this.appendText(m.stepP*(Math.max(Y,d-12)-m.min),m.min,t)}if(n=this.getTextWidth(m.max,t),p*(m.max-l)>=n){var D=m.max-n/2/p;this.appendText(m.stepP*(Math.min(D,l+12)-m.min),m.max,t)}if(f>1)for(e=d+12;l>=e;)this.appendText(m.stepP*(e-m.min),e,t),e+=24}},appendStandardGrid:function(){if(this.$cache.grid=this.$cache.cont.find(".grid").first(),this.$cache.grid.siblings(".grid").remove(),this.$cache.grid.empty(),this.currentGridContainer=null,this.options.format.showRelative)this._prettify=this._prettify_relative,this._prettify_text=this._prettify_text_relative,this.options.major_ticks_offset=0,this._appendStandardGrid();else{var t=moment();if(this._prettify=this._prettify_absolute,this._prettify_text=this._prettify_text_absolute,this.options.major_ticks_offset=-s(t,this.options.format.timezone).hours(),this._appendStandardGrid(),this.appendDateGrid(),"utc"!=this.options.format.timezone&&this.options.format.showUTC){this.options.major_ticks_offset=-s(t,"utc").hours();var i=this.options.format.timezone;this.options.format.timezone="utc";var e={italic:!0,minor:!0},o={color:"#555555"};this._prettify=this._prettify_absolute,this._prettify_text=this._prettify_text_absolute,this._appendStandardGrid(e,o),this.appendDateGrid(e,o),this.options.format.timezone=i}}},setFormat:function(i){this.options.format=t.extend({date:"DMY",time:"24",showRelative:!1,timezone:"utc",showUTC:!1},this.options.format,i),this.options.display.formatStr=("DMY"!=this.options.format.date?"MMM-DD":"DD-MMM")+" "+("24"==this.options.format.time?"HH:mm":"hh:mma"),this.updateDisplay(),this.update()},updateDisplay:function(){function t(t,i){t&&t.text(i)}var i,e,o;for(i=0;2>i;i++)o=i?this.result.to:this.result.from,e=i?this.options.display.to:this.options.display.from,t(e.tzElement,this._valueToFormat(o,this.options.format.timezone)),t(e.utcElement,this._valueToFormat(o,"utc")),t(e.relativeElement,this._valueToFormat(o))}},i.TimeSlider.prototype=t.extend(i.BaseSlider.prototype,i.TimeSlider.prototype)}(jQuery,this,document);