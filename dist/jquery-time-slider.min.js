!function(t,i,e,o){"use strict";function r(t){return t.startOf("hour"),t}function a(t,i){return"local"==i?t.local():"utc"==i?t.utc():t.tz(i)}function s(t){var i=r(moment());return i.add(t,"hours"),i}function n(t,i){return a(s(t),i)}function m(t,i){var e=r(moment());return t===o?(r(i),t=i.diff(e,"hours")):(i=e,i.add(t,"hours")),{m:i,value:t}}var h=1e3;i.TimeSlider=function(e,o,r){function a(i,e,o){i[e]=i[e]||{};for(var r=0;r<o.length;r++){var a=o[r];"string"===t.type(i[e][a])&&(i[e][a]=t(i[e][a]))}}o=t.extend({grid:!0,gridDistances:[1,2,3,6,12,24,48]},o),o.display=o.display||{},a(o.display,"from",["tzElement","utcElement","relativeElement"]),a(o.display,"to",["tzElement","utcElement","relativeElement"]),o.text=t.extend({hourAbbr:"h",minAbbr:"m",now:"now",to:"to"},o.text),o.text.nowUC=o.text.now.charAt(0).toUpperCase()+o.text.now.slice(1),o.values_separator=" "+o.text.to+" ";var s=m(o.min,o.minMoment);o.min=s.value,o.minMoment=s.m,s=m(o.max,o.maxMoment),o.max=s.value,o.maxMoment=s.m,i.BaseSlider.call(this,e,o,r),this.setFromValue(m(o.from,o.fromMoment).value),o.isInterval&&this.setToValue(m(o.to,o.toMoment).value),this.setFormat({},!0)},t.fn.timeSlider=function(e){return this.each(function(){t.data(this,"timeSlider")||t.data(this,"timeSlider",new i.TimeSlider(this,e,h++))})},i.TimeSlider.prototype={_valueToFormat:function(t,i){return i?n(t,i).format(this.options.display.formatStr):this.options.text.nowUC+(t>=0?" + ":" - ")+Math.abs(t)+this.options.text.hourAbbr},hhFormat:function(t){return t.format("24"==this.options.format.time?"HH":"hha")},hhmmFormat:function(t){return t.format("24"==this.options.format.time?"HH:mm":"hh:mma")},_prettify_relative:function(t){return this._valueToFormat(t)},_prettify_text_relative:function(t){return t},_prettify_absolute:function(t){return this._valueToFormat(t,this.options.format.timezone)},_prettify_text_absolute:function(t){var i=n(t,this.options.format.timezone);return this.hhFormat(i)},_prettify_text_absolute_date:function(t){return n(t,this.options.format.timezone).format(this.options.format.dateFormat)},adjustResult:function(){this.result.minMoment=s(this.result.min),this.result.maxMoment=s(this.result.max),this.result.fromMoment=s(this.result.from),this.result.toMoment=s(this.result.to)},appendDateGrid:function(t,i){var e,o,r,a,s,m=this.options,h=0,f=m.stepPx/m.step,p=0,d=!0,u=0,l=0,M=[];for(this.appendGridContainer(),this.calcGridMargin(),this.currentGridContainer.addClass("text-between-ticks"),this._prettify_text=this._prettify_text_absolute_date,e=m.min;e<=m.max;)(e-this.options.major_ticks_offset)%m.tickDistanceNum===0&&0===n(e,this.options.format.timezone).hour()&&(p++,this.appendTick(h,i),d&&(d=!1,u=e),l=e),e+=m.step,h+=m.stepP;if(o=f*(0===p?m.max-m.min:1==p?Math.max(u-m.min,m.max-u):24)-6,!m.format.dateFormat){switch(m.format.date){case"DMY":r=["ddd, DD. MMM YYYY","ddd, DD. MMM YY","DD. MMM YYYY","DD. MMM YY","DD/MM/YYYY","DD/MM/YY","DD/MM","DD"];break;case"MDY":r=["ddd, MMM DD, YYYY","ddd, MMM DD, YY","MMM DD, YYYY","MMM DD, YY","MM/DD/YYYY","MM/DD/YY","MM/DD","DD"];break;case"YMD":r=["ddd, YYYY MMM DD","ddd, YY MMM DD","YYYY MMM DD","YY MMM DD","YYYY/MM/DD","YY/MM/DD","MM/DD","DD"]}for(e=m.min;e<=m.max;)M.push(e),e+=24;for(var c=0;c<r.length;c++){m.format.dateFormat=r[c],a=!0;for(var D=0;D<M.length;D++)if(this.getTextWidth(M[D],t)>o){a=!1;break}if(a)break}a||(m.format.dateFormat="")}if(m.format.dateFormat)if(0===p)this.appendText(m.stepP*((m.max-m.min)/2),m.min,t);else{if(s=this.getTextWidth(m.min,t),f*(u-m.min)>=s){var _=m.min+s/2/f;this.appendText(m.stepP*(Math.max(_,u-12)-m.min),m.min,t)}if(s=this.getTextWidth(m.max,t),f*(m.max-l)>=s){var Y=m.max-s/2/f;this.appendText(m.stepP*(Math.min(Y,l+12)-m.min),m.max,t)}if(p>1)for(e=u+12;l>=e;)this.appendText(m.stepP*(e-m.min),e,t),e+=24}},appendStandardGrid:function(){if(this.$cache.grid=this.$cache.cont.find(".grid").first(),this.$cache.grid.siblings(".grid").remove(),this.$cache.grid.empty(),this.currentGridContainer=null,this.options.format.showRelative)this._prettify=this._prettify_relative,this._prettify_text=this._prettify_text_relative,this.options.major_ticks_offset=0,this._appendStandardGrid();else{var t=moment();if(this._prettify=this._prettify_absolute,this._prettify_text=this._prettify_text_absolute,this.options.major_ticks_offset=-a(t,this.options.format.timezone).hours(),this._appendStandardGrid(),this.appendDateGrid(),"utc"!=this.options.format.timezone&&this.options.format.showUTC){this.options.major_ticks_offset=-a(t,"utc").hours();var i=this.options.format.timezone;this.options.format.timezone="utc";var e={italic:!0,minor:!0},o={color:"#555555"};this._prettify=this._prettify_absolute,this._prettify_text=this._prettify_text_absolute,this._appendStandardGrid(e,o),this.appendDateGrid(e,o),this.options.format.timezone=i}}},setFormat:function(i){this.options.format=t.extend({date:"DMY",time:"24",showRelative:!1,timezone:"utc",showUTC:!1},this.options.format,i),this.options.display.formatStr=("DMY"!=this.options.format.date?"MMM-DD":"DD-MMM")+" "+("24"==this.options.format.time?"HH:mm":"hh:mma"),this.options.format.dateFormat="",this.update(),this.updateDisplay()},updateDisplay:function(){function i(i,e){i&&i.each(function(){t(this).text(e)})}var e,o,r;for(e=0;2>e;e++)r=e?this.result.to:this.result.from,o=e?this.options.display.to:this.options.display.from,i(o.tzElement,this._valueToFormat(r,this.options.format.timezone)),i(o.utcElement,this._valueToFormat(r,"utc")),i(o.relativeElement,this._valueToFormat(r))},preCallback:function(){this.updateDisplay()}},i.TimeSlider.prototype=t.extend({},i.BaseSlider.prototype,i.TimeSlider.prototype)}(jQuery,this,document);